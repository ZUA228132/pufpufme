# TG School Hub v3

Next.js 14 + Supabase + Telegram WebApp.

## Основной функционал

- Онбординг:
  - выбор города/школы из Supabase;
  - заявка на подключение школы;
  - если пользователь — глобальный админ (`is_global_admin = true`), сразу попадает в `/admin`;
  - если пользователь уже привязан к школе, попадает в `/school`.

- Панель главного админа `/admin`:
  - просмотр заявок на новые школы;
  - одобрение заявки = создание города (если его нет), создание школы и привязка автора заявки к школе;
  - отклонение заявки;
  - список школ с city_name и school_admin_id;
  - ручное назначение админа школы по user_id.

- Школа `/school`:
  - базовый фид новостей (таблица `posts` со status = 'published');
  - кнопка "Голосование за админа" → `/school/election`.

- Голосование за админа `/school/election`:
  - пользователь может подать свою кандидатуру (таблица `admin_candidates`);
  - как только кандидатов становится 6+ и ещё нет активных выборов — создаётся запись в `elections` со сроком 24 часа;
  - пользователи школы голосуют за кандидатов (таблица `votes`, 1 голос на выборы);
  - при завершении срока выборов (или при следующем запросе статуса) определяется победитель:
    - кандидат с максимумом голосов;
    - он назначается админом школы (обновление `schools.school_admin_id`);
    - статус выборов меняется на `finished`.

## Что нужно сделать

1. Создать проект в Supabase.
2. Вставить `supabase/schema.sql` в SQL Editor и выполнить.
3. Заполнить таблицу `cities` и `schools` (можно импортом CSV).
4. В Supabase в `users` вручную выставить `is_global_admin = true` нужному пользователю.
5. В `.env.local` прописать:
   - `NEXT_PUBLIC_SUPABASE_URL`
   - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
   - `SUPABASE_SERVICE_ROLE_KEY`
6. Запустить:
   ```bash
   npm install
   npm run dev
   ```

7. Задеплоить на Vercel и прописать те же переменные окружения.

Дальше можно развивать:
- полноценную модерацию новостей и рассылок по школе;
- премиум-подписку;
- чаты классов и жалобы.
